import{r as f,j as e,B as s,a,m as y,ap as b,a8 as _,au as B,av as P,aw as z,ax as A,a9 as $,aq as M,b as v,s as O,ay as q,k as G,a0 as H,D as V,at as J,az as I}from"./mui-vendor-ujBQm9oz.js";import{w as p}from"./index-CB0PPOp-.js";import{i as F}from"./ipfsService-C3tx3sa-.js";import"./react-vendor-DJG_os-6.js";import"./web3-vendor-CUnDX1iN.js";const ee=()=>{const[h,U]=f.useState("tokenId"),[d,N]=f.useState(""),[x,k]=f.useState(!1),[u,j]=f.useState(""),[w,D]=f.useState([]),L=async t=>{if(t.preventDefault(),!d){j("Please enter a value to search");return}k(!0),j(""),D([]);try{await p.isConnected()||await p.connectWallet();let n=[];if(h==="tokenId")try{const r=await p.getCertificateDetails(d),l=await F.fetchMetadata(r.tokenURI);n=[{tokenId:d,owner:r.owner,metadata:l,tokenURI:r.tokenURI}]}catch{throw new Error("Certificate not found or invalid token ID")}else{if(!d.match(/^0x[a-fA-F0-9]{40}$/))throw new Error("Invalid wallet address format");const r=await p.getCertificatesByOwner(d);if(r.length===0)throw new Error("No certificates found for this address");const l=r.map(o=>F.fetchMetadata(o.tokenURI).then(c=>({tokenId:o.tokenId,owner:d,metadata:c,tokenURI:o.tokenURI})).catch(c=>(console.error(`Failed to fetch metadata for token ${o.tokenId}:`,c),null)));n=(await Promise.all(l)).filter(o=>o!==null)}D(n)}catch(n){console.error("Error searching certificates:",n),j(n.message||"Failed to search certificates")}finally{k(!1)}},C=t=>t?new Date(t*1e3).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"N/A",i=(t,n)=>{const r=t==null?void 0:t.find(l=>l.trait_type===n);return(r==null?void 0:r.value)||"N/A"};return e.jsxs(s,{sx:{maxWidth:800,mx:"auto"},children:[e.jsx(a,{variant:"h2",component:"h1",gutterBottom:!0,sx:{fontWeight:700,mb:2},children:"Verify Certificate"}),e.jsx(a,{variant:"body1",color:"text.secondary",sx:{mb:6,fontSize:"1.1rem"},children:"Enter a token ID or wallet address to verify certificate authenticity"}),e.jsx(y,{elevation:0,sx:{mb:4},children:e.jsx(b,{sx:{p:{xs:3,sm:5}},children:e.jsxs(s,{component:"form",onSubmit:L,children:[e.jsxs(_,{component:"fieldset",sx:{mb:2},children:[e.jsx(B,{component:"legend",children:"Search by"}),e.jsxs(P,{row:!0,value:h,onChange:t=>U(t.target.value),children:[e.jsx(z,{value:"tokenId",control:e.jsx(A,{}),label:"Token ID"}),e.jsx(z,{value:"address",control:e.jsx(A,{}),label:"Wallet Address"})]})]}),e.jsx($,{fullWidth:!0,label:h==="tokenId"?"Enter Token ID":"Enter Wallet Address",value:d,onChange:t=>N(t.target.value),margin:"normal",disabled:x,placeholder:h==="tokenId"?"1":"0x..."}),u&&e.jsx(M,{severity:"error",sx:{mt:2},children:u}),e.jsx(v,{type:"submit",variant:"contained",size:"large",fullWidth:!0,disabled:x,startIcon:x?e.jsx(O,{size:20,color:"inherit"}):e.jsx(q,{}),sx:{mt:4,py:2,fontSize:"1.1rem"},children:x?"Searching...":"Verify Certificate"})]})})}),w.map(t=>{var n,r,l,g,o,c,E,S,W;return e.jsx(y,{elevation:0,sx:{mb:4},children:e.jsxs(b,{sx:{p:{xs:3,sm:5}},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[(()=>{var R;const T=i((R=t.metadata)==null?void 0:R.attributes,"Expiration Date"),m=T!=="N/A"&&new Date(T*1e3)<new Date;return e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1,backgroundColor:m?"#fee":"#e7f3e7",px:2,py:1,borderRadius:2},children:[e.jsx(G,{sx:{color:m?"#d32f2f":"#0f5132",fontSize:20}}),e.jsx(a,{variant:"body2",sx:{fontWeight:600,color:m?"#d32f2f":"#0f5132"},children:m?"Expired Certificate":"Verified Certificate"})]})})(),e.jsx(H,{label:`Token #${t.tokenId}`,size:"small",sx:{ml:"auto",fontWeight:600}})]}),e.jsx(V,{sx:{mb:2}}),e.jsxs(s,{sx:{display:"grid",gap:2.5,gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)"}},children:[e.jsxs(s,{children:[e.jsx(a,{variant:"caption",color:"text.secondary",sx:{fontWeight:600,textTransform:"uppercase"},children:"Course Name"}),e.jsx(a,{variant:"body1",sx:{fontWeight:500,mt:.5},children:i((n=t.metadata)==null?void 0:n.attributes,"Course")})]}),e.jsxs(s,{children:[e.jsx(a,{variant:"caption",color:"text.secondary",sx:{fontWeight:600,textTransform:"uppercase"},children:"Issued By"}),e.jsx(a,{variant:"body1",sx:{fontWeight:500,mt:.5},children:i((r=t.metadata)==null?void 0:r.attributes,"Issuer")})]}),e.jsxs(s,{children:[e.jsx(a,{variant:"caption",color:"text.secondary",sx:{fontWeight:600,textTransform:"uppercase"},children:"Student Name"}),e.jsx(a,{variant:"body1",sx:{fontWeight:500,mt:.5},children:i((l=t.metadata)==null?void 0:l.attributes,"Student")})]}),e.jsxs(s,{children:[e.jsx(a,{variant:"caption",color:"text.secondary",sx:{fontWeight:600,textTransform:"uppercase"},children:"Completion Date"}),e.jsx(a,{variant:"body1",sx:{fontWeight:500,mt:.5},children:C(i((g=t.metadata)==null?void 0:g.attributes,"Date"))})]}),i((o=t.metadata)==null?void 0:o.attributes,"Expiration Date")!=="N/A"&&e.jsxs(s,{children:[e.jsx(a,{variant:"caption",color:"text.secondary",sx:{fontWeight:600,textTransform:"uppercase"},children:"Expiration Date"}),e.jsxs(a,{variant:"body1",sx:{fontWeight:500,mt:.5,color:new Date(i((c=t.metadata)==null?void 0:c.attributes,"Expiration Date")*1e3)<new Date?"error.main":"text.primary"},children:[C(i((E=t.metadata)==null?void 0:E.attributes,"Expiration Date")),new Date(i((S=t.metadata)==null?void 0:S.attributes,"Expiration Date")*1e3)<new Date&&e.jsx(a,{component:"span",variant:"caption",sx:{ml:1,color:"error.main"},children:"(Expired)"})]})]}),e.jsxs(s,{sx:{gridColumn:{sm:"span 2"}},children:[e.jsx(a,{variant:"caption",color:"text.secondary",sx:{fontWeight:600,textTransform:"uppercase"},children:"Owner Address"}),e.jsx(a,{variant:"body1",sx:{fontFamily:"monospace",fontSize:"0.875rem",mt:.5},children:t.owner})]}),((W=t.metadata)==null?void 0:W.external_url)&&e.jsxs(s,{sx:{gridColumn:{sm:"span 2"}},children:[e.jsx(a,{variant:"caption",color:"text.secondary",sx:{fontWeight:600,textTransform:"uppercase"},children:"Verification Link"}),e.jsxs(J,{href:t.metadata.external_url,target:"_blank",rel:"noopener",sx:{display:"flex",alignItems:"center",mt:.5},children:[t.metadata.external_url,e.jsx(I,{fontSize:"small",sx:{ml:.5}})]})]})]}),e.jsx(V,{sx:{my:2}}),e.jsxs(s,{sx:{display:"flex",gap:2},children:[e.jsx(v,{variant:"outlined",size:"small",href:`https://sepolia.etherscan.io/token/0x1Fb5EfEaf2f9504DFdE2b4136f711a5E2331a186?a=${t.tokenId}`,target:"_blank",startIcon:e.jsx(I,{}),children:"View on Etherscan"}),t.tokenURI&&e.jsx(v,{variant:"outlined",size:"small",href:t.tokenURI.replace("ipfs://","https://ipfs.io/ipfs/"),target:"_blank",startIcon:e.jsx(I,{}),children:"View Metadata"})]})]})},t.tokenId)}),w.length===0&&!x&&!u&&e.jsx(y,{children:e.jsx(b,{children:e.jsx(a,{variant:"body1",color:"text.secondary",textAlign:"center",children:"Enter a token ID or wallet address to verify a certificate"})})})]})};export{ee as default};
