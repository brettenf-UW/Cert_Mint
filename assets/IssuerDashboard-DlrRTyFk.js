import{ao as ae,r as o,j as e,m,ap as f,d as W,a as r,B as n,a0 as F,aA as ne,aB as ie,S as K,aC as oe,aD as le,i as ce,b as O,aE as de,ab as H,az as ue,aF as xe,aG as he,aH as je,aq as J,s as pe,aI as me,G as w,aJ as fe,aK as ge,aL as ye,P as ve,aM as Ce,aN as _,a9 as be,aa as Ie,ay as we,aO as Se,aP as Y,aQ as ke,aR as Ae,aS as Te}from"./mui-vendor-ujBQm9oz.js";import{w as Ee}from"./index-CB0PPOp-.js";import{i as Q}from"./ipfsService-C3tx3sa-.js";import"./react-vendor-DJG_os-6.js";import"./web3-vendor-CUnDX1iN.js";const X=ae.memo(({certificate:a,onReissue:A,showRecipient:T=!0,compact:v=!1})=>{const[j,P]=o.useState(null),[R,g]=o.useState(!0),[E,S]=o.useState(!1),[z,C]=o.useState(!1);o.useEffect(()=>{(async()=>{if(!a.tokenURI){g(!1);return}try{const p=await Q.fetchMetadata(a.tokenURI);P(p)}catch(p){console.error("Error loading metadata:",p)}finally{g(!1)}})()},[a.tokenURI]);const D=x=>{navigator.clipboard.writeText(x),C(!0),setTimeout(()=>C(!1),2e3)},u=x=>x?new Date(x*1e3).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"N/A",b=x=>{if(!(j!=null&&j.attributes))return null;const p=j.attributes.find(M=>M.trait_type===x);return p==null?void 0:p.value};if(R)return e.jsx(m,{elevation:0,children:e.jsxs(f,{children:[e.jsx(W,{variant:"text",width:"60%",height:32}),e.jsx(W,{variant:"text",width:"40%"}),e.jsx(W,{variant:"text",width:"80%"})]})});if(!j)return e.jsx(m,{elevation:0,children:e.jsx(f,{children:e.jsx(r,{color:"error",children:"Failed to load certificate metadata"})})});const k=b("Course"),L=b("Issuer"),I=b("Student"),N=b("Date");return e.jsx(m,{elevation:0,sx:{mb:2},children:e.jsxs(f,{children:[e.jsx(n,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",children:e.jsxs(n,{flex:1,children:[e.jsxs(n,{display:"flex",alignItems:"center",gap:1,mb:1,children:[e.jsx(r,{variant:"h6",component:"h3",fontWeight:600,children:k||"Certificate"}),e.jsx(F,{size:"small",icon:a.isActive?e.jsx(ne,{}):e.jsx(ie,{}),label:a.isActive?"Active":"Inactive",color:a.isActive?"success":"error",variant:"outlined"})]}),!v&&e.jsxs(e.Fragment,{children:[e.jsxs(n,{display:"flex",alignItems:"center",gap:.5,mb:.5,children:[e.jsx(K,{fontSize:"small",color:"action"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:L||"Unknown Issuer"})]}),N&&e.jsxs(n,{display:"flex",alignItems:"center",gap:.5,mb:.5,children:[e.jsx(oe,{fontSize:"small",color:"action"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:u(N)})]}),T&&(I||a.recipient)&&e.jsxs(n,{display:"flex",alignItems:"center",gap:.5,mb:1,children:[e.jsx(le,{fontSize:"small",color:"action"}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:[I||"No name"," â€¢"]}),e.jsx(ce,{title:z?"Copied!":"Copy address",children:e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{cursor:"pointer","&:hover":{textDecoration:"underline"}},onClick:()=>D(a.recipient),children:[a.recipient.slice(0,6),"...",a.recipient.slice(-4)]})})]})]}),e.jsxs(n,{display:"flex",alignItems:"center",gap:1,mt:1,children:[e.jsx(F,{size:"small",label:`Token #${a.tokenId}`,variant:"outlined"}),A&&e.jsx(O,{size:"small",variant:"outlined",onClick:()=>A(j,a),startIcon:e.jsx(de,{}),children:"Reissue"}),e.jsx(H,{size:"small",href:`https://sepolia.etherscan.io/token/${a.contractAddress||"0x1Fb5EfEaf2f9504DFdE2b4136f711a5E2331a186"}?a=${a.tokenId}`,target:"_blank",rel:"noopener",children:e.jsx(ue,{fontSize:"small"})}),!v&&e.jsx(H,{size:"small",onClick:()=>S(!E),children:E?e.jsx(xe,{}):e.jsx(he,{})})]})]})}),!v&&e.jsx(je,{in:E,children:e.jsxs(n,{mt:2,p:2,bgcolor:"grey.50",borderRadius:1,children:[e.jsx(r,{variant:"subtitle2",gutterBottom:!0,fontWeight:600,children:"Certificate Details"}),e.jsxs(r,{variant:"body2",color:"text.secondary",paragraph:!0,children:[e.jsx("strong",{children:"Current Owner:"})," ",a.currentOwner||a.recipient]}),e.jsxs(r,{variant:"body2",color:"text.secondary",paragraph:!0,children:[e.jsx("strong",{children:"Token URI:"})," ",a.tokenURI]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Transaction:"})," ",e.jsxs("a",{href:`https://sepolia.etherscan.io/tx/${a.transactionHash}`,target:"_blank",rel:"noopener noreferrer",style:{color:"inherit"},children:[a.transactionHash.slice(0,10),"..."]})]})]})})]})})});X.displayName="CertificateCard";const ze=({web3:a,onNavigate:A})=>{const{isConnected:T,isMinter:v,account:j}=a,[P,R]=o.useState(!0),[g,E]=o.useState([]),[S,z]=o.useState({}),[C,D]=o.useState([]),[u,b]=o.useState(""),[k,L]=o.useState("list"),[I,N]=o.useState(0),[x,p]=o.useState({}),[M,$]=o.useState(1),U=12;o.useEffect(()=>{T&&v&&j&&V()},[T,v,j]),o.useEffect(()=>{Z()},[g,u,I]);const V=async()=>{R(!0);try{const{certificates:t,courseStats:s}=await Ee.getCertificatesIssuedBy(j);E(t),z(s);const c=[...new Set(t.map(i=>i.tokenURI).filter(Boolean))],d={};for(const i of c)try{const l=await Q.fetchMetadata(i);d[i]=l}catch(l){console.error("Error loading metadata for",i,l)}p(d)}catch(t){console.error("Error loading certificates:",t)}finally{R(!1)}},Z=()=>{let t=[...g];u&&(t=t.filter(s=>{var l,h,y,G;const c=x[s.tokenURI];if(!c)return!1;const d=((h=(l=c.attributes)==null?void 0:l.find(B=>B.trait_type==="Course"))==null?void 0:h.value)||"",i=((G=(y=c.attributes)==null?void 0:y.find(B=>B.trait_type==="Student"))==null?void 0:G.value)||"";return d.toLowerCase().includes(u.toLowerCase())||i.toLowerCase().includes(u.toLowerCase())||s.recipient.toLowerCase().includes(u.toLowerCase())||s.tokenId.includes(u)})),I===1?t=t.filter(s=>s.isActive):I===2&&(t=t.filter(s=>!s.isActive)),D(t),$(1)},ee=(t,s)=>{var d,i,l,h;const c={courseName:((i=(d=t.attributes)==null?void 0:d.find(y=>y.trait_type==="Course"))==null?void 0:i.value)||"",issuerName:((h=(l=t.attributes)==null?void 0:l.find(y=>y.trait_type==="Issuer"))==null?void 0:h.value)||"",externalUrl:t.external_url||""};sessionStorage.setItem("reissueTemplate",JSON.stringify(c)),A("issue")},te=()=>Object.keys(S).length,se=()=>Object.values(S).reduce((t,s)=>t+s.count,0),re=()=>{let t=0,s=null;return Object.entries(S).forEach(([c,d])=>{var i,l;if(d.count>t){t=d.count;const h=x[c];s=((l=(i=h==null?void 0:h.attributes)==null?void 0:i.find(y=>y.trait_type==="Course"))==null?void 0:l.value)||"Unknown"}}),{name:s,count:t}};if(!T)return e.jsx(m,{children:e.jsx(f,{children:e.jsx(J,{severity:"warning",children:"Please connect your wallet to view your issued certificates."})})});if(!v)return e.jsx(m,{children:e.jsx(f,{children:e.jsx(J,{severity:"error",children:"Your wallet address does not have issuer permissions."})})});if(P)return e.jsx(n,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400,children:e.jsx(pe,{})});const q=re();return e.jsxs(n,{children:[e.jsxs(n,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4,children:[e.jsx(r,{variant:"h2",component:"h1",fontWeight:700,children:"Issuer Dashboard"}),e.jsx(O,{variant:"outlined",startIcon:e.jsx(me,{}),onClick:V,children:"Refresh"})]}),e.jsxs(w,{container:!0,spacing:3,mb:4,children:[e.jsx(w,{item:!0,xs:12,sm:6,md:3,children:e.jsx(m,{elevation:0,children:e.jsxs(f,{children:[e.jsxs(n,{display:"flex",alignItems:"center",gap:1,mb:1,children:[e.jsx(fe,{color:"primary"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Total Issued"})]}),e.jsx(r,{variant:"h4",fontWeight:600,children:g.length})]})})}),e.jsx(w,{item:!0,xs:12,sm:6,md:3,children:e.jsx(m,{elevation:0,children:e.jsxs(f,{children:[e.jsxs(n,{display:"flex",alignItems:"center",gap:1,mb:1,children:[e.jsx(ge,{color:"primary"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Active Certificates"})]}),e.jsx(r,{variant:"h4",fontWeight:600,children:se()})]})})}),e.jsx(w,{item:!0,xs:12,sm:6,md:3,children:e.jsx(m,{elevation:0,children:e.jsxs(f,{children:[e.jsxs(n,{display:"flex",alignItems:"center",gap:1,mb:1,children:[e.jsx(K,{color:"primary"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Unique Courses"})]}),e.jsx(r,{variant:"h4",fontWeight:600,children:te()})]})})}),e.jsx(w,{item:!0,xs:12,sm:6,md:3,children:e.jsx(m,{elevation:0,children:e.jsxs(f,{children:[e.jsxs(n,{display:"flex",alignItems:"center",gap:1,mb:1,children:[e.jsx(ye,{color:"primary"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Most Popular"})]}),e.jsx(r,{variant:"body1",fontWeight:600,noWrap:!0,children:q.name||"N/A"}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:[q.count," certificates"]})]})})})]}),e.jsx(m,{elevation:0,sx:{mb:4},children:e.jsxs(f,{children:[e.jsx(r,{variant:"h6",gutterBottom:!0,fontWeight:600,children:"Course Statistics"}),e.jsx(n,{display:"flex",flexWrap:"wrap",gap:1,children:Object.entries(S).map(([t,s])=>{var i,l;const c=x[t],d=((l=(i=c==null?void 0:c.attributes)==null?void 0:i.find(h=>h.trait_type==="Course"))==null?void 0:l.value)||"Unknown";return e.jsx(F,{label:`${d} (${s.count})`,variant:"outlined",onClick:()=>b(d)},t)})})]})}),e.jsxs(ve,{elevation:0,sx:{p:3},children:[e.jsxs(n,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsxs(Ce,{value:I,onChange:(t,s)=>N(s),children:[e.jsx(_,{label:`All (${g.length})`}),e.jsx(_,{label:`Active (${g.filter(t=>t.isActive).length})`}),e.jsx(_,{label:`Inactive (${g.filter(t=>!t.isActive).length})`})]}),e.jsxs(n,{display:"flex",gap:2,alignItems:"center",children:[e.jsx(be,{size:"small",placeholder:"Search certificates...",value:u,onChange:t=>b(t.target.value),InputProps:{startAdornment:e.jsx(Ie,{position:"start",children:e.jsx(we,{})})},sx:{width:300}}),e.jsxs(Se,{value:k,exclusive:!0,onChange:(t,s)=>s&&L(s),size:"small",children:[e.jsx(Y,{value:"list",children:e.jsx(ke,{})}),e.jsx(Y,{value:"grid",children:e.jsx(Ae,{})})]})]})]}),C.length===0?e.jsxs(n,{textAlign:"center",py:4,children:[e.jsx(r,{color:"text.secondary",children:u?"No certificates match your search":"No certificates issued yet"}),!u&&e.jsx(O,{variant:"contained",sx:{mt:2},onClick:()=>A("issue"),children:"Issue Your First Certificate"})]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{container:!0,spacing:k==="grid"?3:0,children:C.slice((M-1)*U,M*U).map(t=>e.jsx(w,{item:!0,xs:12,md:k==="grid"?6:12,children:e.jsx(X,{certificate:t,onReissue:ee,showRecipient:!0,compact:k==="grid"})},t.tokenId))}),C.length>U&&e.jsx(n,{display:"flex",justifyContent:"center",mt:4,children:e.jsx(Te,{count:Math.ceil(C.length/U),page:M,onChange:(t,s)=>$(s),color:"primary",size:"large"})})]})]})]})};export{ze as default};
